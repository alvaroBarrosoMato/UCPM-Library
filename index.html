<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OneTrust Resilience Test with Fallback Consent</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f7;
      margin: 0;
      padding: 40px;
      display: flex;
      justify-content: center;
    }

    .container {
      background: #ffffff;
      border-radius: 8px;
      padding: 24px 28px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.06);
    }

    h1 {
      font-size: 1.4rem;
      margin: 0 0 12px;
    }

    p {
      margin: 0 0 16px;
      color: #333;
    }

    .status {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 16px;
    }

    .status--ok {
      color: #1a7f37;
    }

    .status--error {
      color: #b3261e;
    }

    /* OneTrust container placeholder */
    #ot-container {
      border: 1px dashed #c8c8c8;
      border-radius: 6px;
      padding: 16px;
      min-height: 80px;
      display: none; /* hidden until OT is “ok” */
    }

    /* Fallback consent block */
    #ot-fallback-consent {
      display: none; /* only shown on OT failure */
      border-radius: 6px;
      border: 1px solid #ffd7d7;
      background: #fff5f5;
      padding: 16px;
      margin-top: 8px;
    }

    #ot-fallback-consent label {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      font-size: 0.95rem;
      color: #222;
      cursor: pointer;
    }

    #ot-fallback-checkbox {
      margin-top: 2px;
    }

    .fallback-note {
      font-size: 0.8rem;
      color: #b3261e;
      margin-top: 8px;
    }

    /* Button just for demo / dev */
    .btn-row {
      margin-top: 20px;
      display: flex;
      gap: 8px;
    }

    button {
      border-radius: 4px;
      padding: 8px 14px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .btn-primary {
      background: #0067b8;
      color: #fff;
    }

    .btn-secondary {
      background: #e1e4ea;
      color: #111;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>OneTrust Resilience Test</h1>
    <p>
      This page simulates loading a OneTrust Collection Point and falls back
      to a simple consent checkbox when the OneTrust consent API is unavailable.
    </p>

    <div id="status" class="status">Checking OneTrust availability…</div>

    <!-- Normal OneTrust CP target -->
    <div id="ot-container">
      <!-- OneTrust CP will be rendered here by OneTrust.webform.InstallCP(...) -->
    </div>

    <!-- Fallback consent when OneTrust fails -->
    <div id="ot-fallback-consent">
      <label for="ot-fallback-checkbox">
        <input
          type="checkbox"
          id="ot-fallback-checkbox"
          name="otFallbackConsent"
        />
        <span>
          I agree that my personal data may be processed in accordance with the
          Privacy Notice and used for relevant communications and marketing.
        </span>
      </label>
      <div class="fallback-note">
        The standard consent platform is temporarily unavailable. Your choice
        has been captured in this fallback consent.
      </div>
    </div>

    <!-- Optional: simple dev buttons to force each path -->
    <div class="btn-row">
      <button class="btn-primary" onclick="simulateSuccess()">Simulate OT Success</button>
      <button class="btn-secondary" onclick="simulateFailure()">Simulate OT Failure</button>
    </div>
  </div>

  <script>
    // ---------- CONFIG ----------
    const OT_TEST_URL =
      "https://consent-api.onetrust.com/cfw/consent/v1/cp/list"; // The URL that currently 404s in your console
    const OT_TIMEOUT_MS = 4000; // Max time we wait before assuming OT is not reachable
    const OT_CP_ID = "0ceb7c0c-d27e-43c6-9c9c-877694285648"; // ← replace with your CP ID if you want to test real embedding

    const statusEl = document.getElementById("status");
    const otContainer = document.getElementById("ot-container");
    const fallbackEl = document.getElementById("ot-fallback-consent");

    function showOTStatus(message, isError = false) {
      statusEl.textContent = message;
      statusEl.classList.toggle("status--error", isError);
      statusEl.classList.toggle("status--ok", !isError);
    }

    function showFallback() {
      otContainer.style.display = "none";
      fallbackEl.style.display = "block";
      showOTStatus(
        "OneTrust consent service is unavailable – fallback consent is active.",
        true
      );
      console.warn("[OT Resilience] Falling back to simple consent checkbox.");
    }

    function showOTContainer() {
      fallbackEl.style.display = "none";
      otContainer.style.display = "block";
      showOTStatus("OneTrust consent service is available.", false);
    }

    // ---- Core test: ping OneTrust, then decide OT vs fallback ----
    function checkOneTrustAvailability() {
      showOTStatus("Checking OneTrust availability…");

      const controller = new AbortController();
      const timeoutId = setTimeout(() => {
        controller.abort();
      }, OT_TIMEOUT_MS);

      fetch(OT_TEST_URL, { method: "GET", signal: controller.signal })
        .then((response) => {
          clearTimeout(timeoutId);
          // Treat 2xx as success; everything else as failure for this test
          if (response.ok) {
            console.info("[OT Resilience] OneTrust API responded OK:", response.status);
            onOneTrustAvailable();
          } else {
            console.error(
              "[OT Resilience] OneTrust API responded with error status:",
              response.status
            );
            showFallback();
          }
        })
        .catch((error) => {
          clearTimeout(timeoutId);
          console.error("[OT Resilience] Error contacting OneTrust API:", error);
          showFallback();
        });
    }

    // ---- When OT is available: embed the CP as you normally would ----
    function onOneTrustAvailable() {
      showOTContainer();

      // If you are using the OneTrust webform API in your real UI, it would look like:
      // OneTrust.webform.InstallCP(OT_CP_ID, { target: "#ot-container" });
      // and then oneTrust.webform.preFill(...) once the SDK is ready. [1](https://m365.cloud.microsoft/chat/pages/eyJ1IjoiaHR0cHM6Ly9vbmV0cnVzdC5zaGFyZXBvaW50LmNvbS9jb250ZW50c3RvcmFnZS94OEZOTy14dHNrdUNSWDJfZk1USExiYjVST3VHRlBGQm5GSjNmN2pqWVBFP25hdj1jejBsTWtaamIyNTBaVzUwYzNSdmNtRm5aU1V5Um5nNFJrNVBKVEpFZUhSemEzVkRVbGd5SlRWR1prMVVTRXhpWWpWU1QzVkhSbEJHUW01R1NqTm1OMnBxV1ZCRkptUTlZaVV5TVNVMVJqTnRPR2w1TkZGVlZWTmhOVE5JSlRWR1JHNVZhbHB2YjJwSWFXeFpVMDUwUjNOaGEwaE9KVEpFWjAxaVJYTWxNa1J0UzNac1RVMUNOVkUwU1VNd1dHOHdNMUpyYlNabVBUQXhSVTFXU3pSVk5GZzNWRlkwVFVkRVZVRmFRVXMyUlZOVlVVVlhSVTlDU1ZjbVl6MGxNa1kifQ?auth=2)

      try {
        if (window.OneTrust && OneTrust.webform && typeof OneTrust.webform.InstallCP === "function") {
          OneTrust.webform.InstallCP(OT_CP_ID, { target: "#ot-container" });
          console.info("[OT Resilience] OneTrust CP installed into #ot-container");
        } else {
          console.warn(
            "[OT Resilience] OneTrust SDK not present on page – only simulating success path."
          );
          otContainer.innerHTML =
            "<p><strong>Simulated OneTrust CP:</strong> SDK not loaded on this page, but OT is considered available.</p>";
        }
      } catch (e) {
        console.error("[OT Resilience] Error calling OneTrust.webform.InstallCP:", e);
        showFallback();
      }
    }

    // ---------- Dev helpers to trigger paths without changing network ----------
    function simulateSuccess() {
      console.log("[OT Resilience] Developer forced success path.");
      onOneTrustAvailable();
    }

    function simulateFailure() {
      console.log("[OT Resilience] Developer forced failure path.");
      showFallback();
    }

    // Kick off the real check once the DOM is ready
    document.addEventListener("DOMContentLoaded", checkOneTrustAvailability);
  </script>
</body>
</html>
``
